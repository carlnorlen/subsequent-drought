#The undersampled dataset
dataset.under <- getTaskData(task.under)
#Scale data sets to help with relative importance analysis.
dataset.under$dNDMI.scale <- scale(dataset.under$dNDMI)
dataset.under$PET_4yr.scale <- scale(dataset.under$PET_4yr)
dataset.under$biomass.scale <- scale(dataset.under$biomass)
dataset.under$tmax_4yr.scale <- scale(dataset.under$tmax_4yr)
dataset.under$sequence.scale <- scale(as.numeric(dataset.under$sequence.f))
dataset.under$drought.scale <- scale(as.numeric(dataset.under$drought.f))
#The full multiple regression linear model
dndmi.under.lm = lm(data = dataset.under,
formula = dNDMI ~ drought.f * sequence.f + PET_4yr + tmax_4yr + biomass)
#Get the model results as a dataframe
df.dndmi.lm <- dndmi.under.lm %>% tidy() %>% as.data.frame()
#Label the columns of the data frame
df.dndmi.lm$variable <- c('Intercept', 'Time Period', 'Drought Sequence', 'four-year Pr-ET', 'four-year Temperature', 'Biomass', 'Time Period:Drought Sequence')
#Calculate the relative importance of model variables with a relative weight analysis.
dndmi.relimp <- calc.relimp(dndmi.under.lm, rela = TRUE, type = "lmg")
#Add the results of the relative weigth analysis to the data frame
df.dndmi.lm$relimp <- c(0, 0.03706293, 0.01952194, 0.36576597, 0.09262433, 0.02743045, 0.45759438)
#Covert the relative weight analysis outputs as percentages
df.dndmi.lm$relimp.pct <- df.dndmi.lm$relimp * 100
#Create a table of the relative weight analysis results
df.dndmi.tbl <- df.dndmi.lm %>% dplyr::select(variable, estimate, std.error, statistic, p.value, relimp.pct)
#Update the relative weight analysis column names
colnames(df.dndmi.tbl) <- c('Variable', 'Coefficient', 'Standard Error', 'T-Statistic', 'p-value', 'Relative Importance (%)')
#Create the data table with a title
tba <- kbl(df.dndmi.tbl, caption = "Table S4: Die-off (dNDMI) Multiple Linear Regression", digits = 3) %>% kable_classic_2(font_size = 14, full_width = F)
#Export the data table as a .PNG file
as_image(x = tba, width = 6, file = "STable4_multiple_regression_results.png", zoom = 5.0)
#Convert the dummy data back to a numeric format
dataset.under$sequence.f <- as.numeric(dataset.under$sequence.f)
dataset.under$drought.f <- as.numeric(dataset.under$drought.f)
#Filter the data into subsets for modeling
all.ca.both.1999 <- all.ca.sample %>% filter(sequence == 'Both Droughts' & drought == '1999-2002' & !is.na(sequence))
all.ca.both.2012 <- all.ca.sample %>% filter(sequence == 'Both Droughts' & drought == '2012-2015' & !is.na(sequence))
all.ca.second.1999 <- all.ca.sample %>% filter(sequence == '2nd Drought Only' & drought == '1999-2002' & !is.na(sequence))
all.ca.second.2012 <- all.ca.sample %>% filter(sequence == '2nd Drought Only' & drought == '2012-2015' & !is.na(sequence))
# #Linear Models for dNDMI ~ Pr-ET
#Models for Both Droughts
all.ca.both.1999.lm <- lm(data = all.ca.both.1999, dNDMI ~ PET_4yr) # 1999-2002 Model
all.ca.both.2012.lm <- lm(data = all.ca.both.2012, dNDMI ~ PET_4yr) # 2012-2015 Model
#Models for 2012-2015 Only
all.ca.second.1999.lm <- lm(data = all.ca.second.1999, dNDMI ~ PET_4yr) # 1999-2002 Model
all.ca.second.2012.lm <- lm(data = all.ca.second.2012, dNDMI ~ PET_4yr) # 2012-2015 Model
#Calculate the sgemented models
all.ca.both.1999.seg <- segmented(all.ca.both.1999.lm)
all.ca.both.2012.seg <- segmented(all.ca.both.2012.lm)
all.ca.second.1999.seg <- segmented(all.ca.second.1999.lm)
all.ca.second.2012.seg <- segmented(all.ca.second.2012.lm)
#Add predicted dNDMI values
all.ca.both.1999$dNDMI_predict = predict(all.ca.both.1999.seg)
all.ca.both.2012$dNDMI_predict = predict(all.ca.both.2012.seg )
all.ca.second.1999$dNDMI_predict = predict(all.ca.second.1999.seg)
all.ca.second.2012$dNDMI_predict = predict(all.ca.second.2012.seg)
#Add the segmented fits and Standard Errors
#Fits
all.ca.both.1999$dNDMI.fit = broken.line(all.ca.both.1999.seg)$fit
all.ca.both.2012$dNDMI.fit = broken.line(all.ca.both.2012.seg )$fit
all.ca.second.1999$dNDMI.fit = broken.line(all.ca.second.1999.seg)$fit
all.ca.second.2012$dNDMI.fit = broken.line(all.ca.second.2012.seg)$fit
#SE fit
all.ca.both.1999$dNDMI.se.fit = broken.line(all.ca.both.1999.seg)$se.fit
all.ca.both.2012$dNDMI.se.fit = broken.line(all.ca.both.2012.seg )$se.fit
all.ca.second.1999$dNDMI.se.fit = broken.line(all.ca.second.1999.seg)$se.fit
all.ca.second.2012$dNDMI.se.fit = broken.line(all.ca.second.2012.seg)$se.fit
#Recombine the data frames with the model fitted dNDMI as a column
all.ca.models <- rbind(all.ca.both.1999, all.ca.both.2012, all.ca.second.1999, all.ca.second.2012)
summary(all.ca.sample)
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(0.5, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.75, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = FALSE) +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = tmax.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,600), breaks = c(5,150,300,450), midpoint = 300, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 600), na.value = 0.4) +
ylim(0.1, -0.3) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.7, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
ET_4yr.both.1999.lm <- lm(data = all.ca.both.1999, dNDMI ~ ET_4yr) # 1999-2002 Model
ET_4yr.both.2012.lm <- lm(data = all.ca.both.2012, dNDMI ~ ET_4yr) # 2012-2015 Model
#Models for 2012-2015 Only
ET_4yr.second.1999.lm <- lm(data = all.ca.second.1999, dNDMI ~ ET_4yr) # 1999-2002 Model
ET_4yr.second.2012.lm <- lm(data = all.ca.second.2012, dNDMI ~ ET_4yr) # 2012-2015 Model
#R-Squared values for the four models
ET.r2.a  <- format(summary(ET_4yr.both.1999.lm)$r.squared, digits = 2) #I could switch this back to segmented
ET.r2.b <- format(summary(ET_4yr.both.2012.lm)$r.squared, digits = 2)
ET.r2.c <- format(summary(ET_4yr.second.1999.lm)$r.squared, digits = 2)
ET.r2.d <- format(summary(ET_4yr.second.2012.lm)$r.squared, digits = 2)
#Add the letter labels for teh sub-plots.
ET.letter.text <- data.frame(label = c("a)", "b)", "c)", "d)"),
sequence   = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002',  '2012-2015'),
y     = c(-0.3, -0.3, -0.3, -0.3),
x     = c(25, 25, 25, 25)
)
ET.r2.text <- data.frame(
label = c(as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 =bio.r2.a)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = bio.r2.b)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = bio.r2.c)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = bio.r2.d))))
),
sequence = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002', '2012-2015'),
x = c(425, 425, 425, 425),
y = c(-0.25, -0.25, -0.25, -0.25)
)
#four-year ET vs. dNDMI faceted plot regression
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(0.5, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.75, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = FALSE) +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,600), breaks = c(5,150,300,450), midpoint = 300, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 600), na.value = 0.4) +
ylim(0.1, -0.3) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.7, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(10, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.75, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,600), breaks = c(5,150,300,450), midpoint = 300, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 600), na.value = 0.4) +
ylim(0.1, -0.3) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.75, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,600), breaks = c(5,150,300,450), midpoint = 300, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 600), na.value = 0.4) +
ylim(0.1, -0.3) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.75, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
# scale_fill_gradient2(limits = c(0,600), breaks = c(5,150,300,450), midpoint = 300, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 600), na.value = 0.4) +
ylim(0.1, -0.3) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.75, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,100), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.75, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,1000), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.25, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,1000), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.2, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,1000), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.15, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,1000), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.7, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.9, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
ggsave(filename = 'FigS20_4yr_ET_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
ET.letter.text <- data.frame(label = c("a)", "b)", "c)", "d)"),
sequence   = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002',  '2012-2015'),
y     = c(-0.35, -0.35, -0.35, -0.35),
x     = c(200, 200, 200, 200)
)
ET.r2.text <- data.frame(
label = c(as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 =bio.r2.a)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = bio.r2.b)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = bio.r2.c)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = bio.r2.d))))
),
sequence = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002', '2012-2015'),
x = c(425, 425, 425, 425),
y = c(-0.3, -0.3, -0.3, -0.3)
)
#four-year ET vs. dNDMI faceted plot regression
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.15, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,1000), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
#Add a shared legend in a customized position on the figure
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.95, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
ggsave(filename = 'FigS20_4yr_ET_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
ET.letter.text <- data.frame(label = c("a)", "b)", "c)", "d)"),
sequence   = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002',  '2012-2015'),
y     = c(-0.35, -0.35, -0.35, -0.35),
x     = c(300, 300, 300, 300)
)
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.15, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,1000), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
#Add a shared legend in a customized position on the figure
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.98, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
ggsave(filename = 'FigS20_4yr_ET_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.98, 0.85),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
ggsave(filename = 'FigS20_4yr_ET_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
ET.letter.text <- data.frame(label = c("a)", "b)", "c)", "d)"),
sequence   = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002',  '2012-2015'),
y     = c(-0.32, -0.32, -0.32, -0.32),
x     = c(350, 350, 350, 350)
)
p11 <- ggscatter(all.ca.sample %>% filter(sequence == 'Both Droughts' | sequence == '2nd Drought Only'), x = "ET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
geom_smooth(method = 'lm', formula = y ~ x, size = 2, linetype = 'dotdash', se = TRUE, level = 0.95, color = 'black') +
stat_cor(aes(label = paste(..rr.label..)), color = 'black', label.x.npc = 0.15, label.y.npc = 0.9, size = 3.5, digits = 2) +
theme_bw() + guides(alpha = 'none') +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('four-year ET (mm 4yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
# geom_text(data = bio.r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = ET.letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,1500), breaks = c(5,500,1000), midpoint = 750, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 1500), na.value = 0.4) +
ylim(0.1, -0.35) + #xlim(0, 475) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
p11
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(1.0, 0.85),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
ggsave(filename = 'FigS20_4yr_ET_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
p12 <- p11 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(1.0, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(
fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p12
ggsave(filename = 'SFig20_4yr_ET_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
