join.second$DIA.stdDev.live[is.na(join.second$DIA.stdDev.live)] <- 0
join.second$BasalArea.live[is.na(join.second$BasalArea.live)] <- 0
#Filling in dead conifer plot variables
join.second$count.dead[is.na(join.second$count.dead)] <- 0
join.second$biomass.dead[is.na(join.second$biomass.dead)] <- 0
join.second$DIA.mean.dead[is.na(join.second$DIA.mean.dead)] <- 0
join.second$DIA.stdDev.dead[is.na(join.second$DIA.stdDev.dead)] <- 0
join.second$BasalArea.dead[is.na(join.second$BasalArea.dead)] <- 0
#Join data tables
trees.second.join <- left_join(trees.second.group, join.second, by = c('PLOT', 'drought'))
trees.second.join
#Calculate mortality percentages with different data
trees.second.join$mort.count <- (trees.second.join$count.dead / (trees.second.join$count.plot)) * 100
trees.second.join$mort.biomass <- (trees.second.join$biomass.dead / (trees.second.join$biomass.plot)) * 100
trees.second.join$mort.BasalArea <- (trees.second.join$BasalArea.dead / (trees.second.join$BasalArea.plot)) * 100
#Get the data for the full plot
plot.second.group <- subset(trees.second, tree_type == 'pine/fir') %>% group_by(PLOT, Tree_Status, drought) %>% summarize(
biomass = sum(live_biomass),
count = sum(count),
basal_area = sum(basal_area)
)
#Convert into a data frame
plot.second.group <- as.data.frame(plot.second.group)
#Get summary data by plot
plot.second.summary <- plot.second.group %>% group_by(Tree_Status, drought) %>% summarize(
biomass.mean = mean(biomass),
biomass.sd = sd(biomass),
biomass.se = sd(biomass) / sqrt(length(biomass)),
count.mean = mean(count),
count.sd = sd(count),
count.se = sd(count) / sqrt(length(count)),
basal_area.mean = mean(basal_area),
basal_area.sd = sd(basal_area),
basal_area.se = sd(basal_area) / sqrt(length(basal_area))
)
#Convert into a data frame
plot.second.summmary <- as.data.frame(plot.second.summary)
#Summarize by tree type
trees.second.type <- trees.second %>% group_by(tree_type, PLOT, Tree_Status, drought) %>% summarize(
biomass = sum(live_biomass),
count = sum(count),
basal_area = sum(basal_area)
)
#Convert into a data frame
trees.second.type <- as.data.frame(trees.second.type)
#Full plot summaries
type.second.sum <- trees.second %>% group_by(tree_type, PLOT, drought) %>% summarize(
biomass = sum(live_biomass),
count = sum(count),
basal_area = sum(basal_area)
)
#Adding in zero rows for Tree Types analysis
type.second.live.pine <- subset(trees.second.type, Tree_Status == 'Live' & tree_type == 'pine/fir')
colnames(type.second.live.pine) <- c("tree_type", "PLOT", "Tree_Status", "drought", "biomass.live", "count.live", "basal_area.live")
join.type.second.live.pine <- left_join(plots.second.both, type.second.live.pine, by = c('PLOT', 'drought'))
join.type.second.live.pine$Tree_Status <- 'Live'
type.second.live.other <- subset(trees.second.type, Tree_Status == 'Live' & tree_type == 'other tree')
colnames(type.second.live.other) <- c("tree_type", "PLOT", "Tree_Status", "drought", "biomass.live", "count.live", "basal_area.live")
join.type.second.live.other <- left_join(plots.second.both, type.second.live.other, by = c('PLOT', 'drought'))
join.type.second.live.other$Tree_Status <- 'Live'
type.second.live <- rbind(join.type.second.live.pine, join.type.second.live.other)
type.second.live <- dplyr::select(type.second.live, -rmv)
# trees.second.type
type.second.dead.pine <- subset(trees.second.type, Tree_Status == 'Dead' & tree_type == 'pine/fir')
colnames(type.second.dead.pine) <- c("tree_type", "PLOT", "Tree_Status", "drought", "biomass.dead", "count.dead", "basal_area.dead")
join.type.second.dead.pine <- left_join(plots.second.both, type.second.dead.pine, by = c('PLOT', 'drought'))
join.type.second.dead.pine$Tree_Status <- 'Dead'
# join.type.second.dead.pine
type.second.dead.other <- subset(trees.second.type, Tree_Status == 'Dead' & tree_type == 'other tree')
colnames(type.second.dead.other) <- c("tree_type", "PLOT", "Tree_Status", "drought", "biomass.dead", "count.dead", "basal_area.dead")
join.type.second.dead.other <- left_join(plots.second.both, type.second.dead.other, by = c('PLOT', 'drought'))
join.type.second.dead.other$Tree_Status <- 'Dead'
type.second.dead <- rbind(join.type.second.dead.pine, join.type.second.dead.other)
type.second.dead <- dplyr::select(type.second.dead, -rmv)
type.second.join <- left_join(type.second.sum, type.second.live, by = c('PLOT', 'drought', 'tree_type'))
type.second.all <- left_join(type.second.join, type.second.dead, by = c('PLOT', 'drought', 'tree_type'))
#Filling in live plot variables
type.second.all$count.live[is.na(type.second.all$count.live)] <- 0
type.second.all$biomass.live[is.na(type.second.all$biomass.live)] <- 0
type.second.all$basal_area.live[is.na(type.second.all$basal_area.live)] <- 0
#Filling in dead plot variables
type.second.all$count.dead[is.na(type.second.all$count.dead)] <- 0
type.second.all$biomass.dead[is.na(type.second.all$biomass.dead)] <- 0
type.second.all$basal_area.dead[is.na(type.second.all$basal_area.dead)] <- 0
type.second.all$basal_area.mort <- type.second.all$basal_area.dead / type.second.all$basal_area * 100
type.second.all <- as.data.frame(type.second.all)
#Summaries by tree types
type.second.summary <- type.second.all %>% group_by(tree_type, drought) %>% summarize(
biomass.mean = mean(biomass),
biomass.sd = sd(biomass),
biomass.se = sd(biomass) / sqrt(length(biomass)),
count.mean = mean(count),
count.sd = sd(count),
count.se = sd(count) / sqrt(length(count)),
basal_area.mean = mean(basal_area),
basal_area.sd = sd(basal_area),
basal_area.se = sd(basal_area) / sqrt(length(basal_area.dead)),
basal_area.dead.mean = mean(basal_area.dead),
basal_area.dead.sd = sd(basal_area.dead),
basal_area.dead.se = sd(basal_area.dead) / sqrt(length(basal_area.dead)),
mortality.mean = mean(basal_area.mort),
mortality.sd = sd(basal_area.mort),
mortality.se = sd(basal_area.mort) / sqrt(length(basal_area.mort)),
sample.size = length(count)
)
#Make the summary by tree type a data frame
type.second.summary <- as.data.frame(type.second.summary)
#Add the drought exposure sequence to the script.
type.summary$sequence <- 'Both Droughts'
type.second.summary$sequence <- '2012-2015 Only'
type.summary.all <- rbind(type.summary, type.second.summary)
# Combining the type data for the two drought sequence regions
type.all$sequence <- 'Both Droughts'
type.second.all$sequence <- '2012-2015 Only'
type.both.all <- rbind(type.all, type.second.all)
#Make tree_type a factor
type.both.all$tree_type <- factor(type.both.all$tree_type, levels = c("pine/fir", "other tree"))
p1_texta <- data.frame(label = c("a", "bc", "b", "c"),
sequence   = c('Both Droughts', 'Both Droughts', '2012-2015 Only', '2012-2015 Only'),
y     = c(39.5, 16, 8, 22.5),
x     = c(1, 2, 1, 2)
)
#Letters to indicate sample sizes
p1_textb <- data.frame(label = c("n = 44", "n = 26", "n = 199", "n = 192"),
sequence   = c('Both Droughts', 'Both Droughts', '2012-2015 Only', '2012-2015 Only'),
y     = c(34.5, 11, 3, 17.5),
x     = c(1, 2, 1, 2)
)
#Create the mortality (%) bar chart
p1 <- ggbarplot(filter(type.both.all), x = "drought", y = "basal_area.mort", fill = "tree_type",
ylab = 'Mortality (%)', xlab = "Time Period", order = c("1999-2002", "2012-2015"), position = position_dodge(), #stat = "density",
add = "mean_se" , error.plot = "errorbar", alpha = 0.8) +
guides(color = "none") + theme_bw() +
scale_fill_manual(values = c("#E66100", "#5D3A9B"), name = 'Tree \n',
labels = c("pine/fir" = "Needleleaf \nConifer", "other tree" = 'Other \nTrees'),
labels = c("Both Droughts" =  "Both \nDroughts", "2012-2015 Only" = "2012-2015 \nOnly"),
aesthetics = "fill") +
theme(legend.background = element_rect(colour = NA, fill = NA), legend.justification = c(1, 0),
legend.position = c(0.75, 0.45), legend.text = element_text(size = 6), legend.title = element_text(size = 8),
legend.direction = "vertical", axis.text.x = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10)) +
geom_text(data = p1_texta, mapping = aes(x = x, y = y, label = label), size = 5) +
geom_text(data = p1_textb, mapping = aes(x = x, y = y, label = label), size = 3) +
geom_text(data = data.frame(label = "Mean \n+/- SE", y = 30, x = 1.25, sequence = 'Both Droughts'), mapping = aes(x=x, y=y, label = label), size = 2) +
facet_grid(~ factor(sequence, levels = c('Both Droughts', '2012-2015 Only')))
p1 <- ggbarplot(filter(type.both.all), x = "drought", y = "basal_area.mort", fill = "tree_type",
ylab = 'Mortality (%)', xlab = "Time Period", order = c("1999-2002", "2012-2015"), position = position_dodge(), #stat = "density",
add = "mean_se" , error.plot = "errorbar", alpha = 0.8) +
guides(color = "none") + theme_bw() +
scale_fill_manual(values = c("#E66100", "#5D3A9B"), name = 'Tree \n',
labels = c("pine/fir" = "Needleleaf \nConifer", "other tree" = 'Other \nTrees'),
#labels = c("Both Droughts" =  "Both \nDroughts", "2012-2015 Only" = "2012-2015 \nOnly"),
aesthetics = "fill") +
theme(legend.background = element_rect(colour = NA, fill = NA), legend.justification = c(1, 0),
legend.position = c(0.75, 0.45), legend.text = element_text(size = 6), legend.title = element_text(size = 8),
legend.direction = "vertical", axis.text.x = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10)) +
geom_text(data = p1_texta, mapping = aes(x = x, y = y, label = label), size = 5) +
geom_text(data = p1_textb, mapping = aes(x = x, y = y, label = label), size = 3) +
geom_text(data = data.frame(label = "Mean \n+/- SE", y = 30, x = 1.25, sequence = 'Both Droughts'), mapping = aes(x=x, y=y, label = label), size = 2) +
facet_grid(~ factor(sequence, levels = c('Both Droughts', '2012-2015 Only')))
p1
head(type.second.all)
plot.second.sum <- trees.second %>% group_by(PLOT, drought) %>% summarize(
biomass = sum(live_biomass),
count = sum(count),
basal_area = sum(basal_area)
)
head(plot.second.sum)
plot.second.sum <- trees.second %>% group_by(PLOT, drought, Tree_Status) %>% summarize(
biomass = sum(live_biomass),
count = sum(count),
basal_area = sum(basal_area)
)
head(plot.second.sum)
head(type.second.all)
#Author: Carl Norlen
#Date Created: February 6, 2020
#Date Updated: January 14, 2022
#Purpose: Create Figure 2 time series for publication
#Load required scripts for teh script
p <- c('ggpubr', 'tidyr', 'dplyr', 'ggplot2', 'patchwork')
lapply(p,require,character.only=TRUE)
setwd('C:/Users/can02/mystuff/subsequent-drought')
#Directory for loading data
land_dir <- "D:\\Large_Files\\Landsat"
#Load Time Series data sets
first <- read.csv(file.path(land_dir, 'dNDMI_NDMI_PET_Temp_ADS_trajectories_first_drought_full_region_300m_v9.csv'))
second <- read.csv(file.path(land_dir, 'dNDMI_NDMI_PET_Temp_ADS_trajectories_second_drought_full_region_300m_v9.csv'))
#Add the group name for each time series
first$drought <- '2012-2015 Only'
second$drought <- 'Both Droughts'
#Add sample size for each time series
first$count <- as.numeric(8923)
second$count <- as.numeric(49222)
#Combine the time series data into on data frame
time.series <- rbind(first, second)
#Rename the system.time_start column
names(time.series)[names(time.series) == 'system.time_start'] <- 'time_start'
#Convert time_start to a Date object
time.series$time_start <- as.Date(time.series$time_start)
#Create a year column
time.series$year <- format(time.series$time_start, '%Y')
#Convert acres to hectares
time.series$tpa_sum <- time.series$tpa_sum * 2.41705 * 2.25 # convert acres to hectares and then convert 150 m pixels (2.25 hectares) into number of dead trees
# time.series$tpa <- time.series$tpa_sum / (time.series$tpa_count * 2.25)
time.series$tpa_mean <- time.series$tpa_mean * 2.41705
time.series$tpa_stdDev <- time.series$tpa_stdDev * 2.41705
# time.series$tpa_stdError <- time.series$tpa_stdDev / sqrt(time.series$tpa_count)
time.series$tpa_p100 <- time.series$tpa_p100 * 2.41705
time.series$tpa_p50 <- time.series$tpa_p50 * 2.41705
time.series$tpa_p75 <- time.series$tpa_p75 * 2.41705
time.series$tpa_p25 <- time.series$tpa_p25 * 2.41705
time.series$tpa_low_area <- (time.series$tpa_mid_sum / time.series$tpa_count) * 100
#Make the drought/Region a factor
time.series$drought <- factor(time.series$drought)
#Create an ADS proportion time series
p1 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = tpa_low_area, color = drought, linetype = drought), size = 0.5, na.rm = TRUE) +
theme_bw() + guides(color = guide_legend(title = 'Drought Sequence', nrow = 2, title.position = 'top'), linetype = "none") +
scale_linetype_manual(values=c("solid", "twodash")) +
geom_hline(yintercept = 0, linetype='dashed') +
scale_color_manual(values=c("#E66100", "#5D3A9B"), labels = c('Both \nDroughts', '2012-2015 \nOnly')) +
theme(axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10), axis.title.x = element_blank(), legend.position = c(0.2, 0.6), legend.background = element_rect(colour = NA, fill = NA),
legend.key = element_rect(fill = NA), axis.text.x = element_blank(), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
ylab('Die-off\n(% Area)')
#Create a dNDMI time series
p2 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = dNDMI_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=dNDMI_mean - (dNDMI_stdDev / sqrt(count) * 1.96), ymax=dNDMI_mean + (dNDMI_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() + geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10), axis.title.x=element_blank(), legend.position = 'none',
axis.text.x=element_blank(), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
ylab('dNDMI') + geom_text(data = data.frame(label = "95% CI", x = as.Date('2018-06-30'), y = -0.019, sequence = 'Both Droughts'), mapping = aes(x=x, y=y, label = label), size = 1)
#Create a biomass density time series.
p3 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = biomass_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=biomass_mean - (biomass_stdDev / sqrt(count) * 1.96), ymax=biomass_mean + (biomass_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Create a Pr-ET time series graph
p4 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = PET_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=PET_mean - (PET_stdDev / sqrt(count) * 1.96), ymax=PET_mean + (PET_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Combine the three time series graphs into one
(p1 / p2 / p3 / p4) + plot_annotation(tag_levels = 'a', theme = theme(legend.margin=margin(t = 0, unit='cm'))) + plot_layout(heights = c(0.95,0.95,0.95,1))
p <- c('ggpubr', 'tidyr', 'dplyr', 'ggplot2', 'patchwork')
lapply(p,require,character.only=TRUE)
setwd('C:/Users/can02/mystuff/subsequent-drought')
#Directory for loading data
land_dir <- "D:\\Large_Files\\Landsat"
#Load Time Series data sets
first <- read.csv(file.path(land_dir, 'dNDMI_NDMI_PET_Temp_ADS_trajectories_first_drought_full_region_300m_v9.csv'))
second <- read.csv(file.path(land_dir, 'dNDMI_NDMI_PET_Temp_ADS_trajectories_second_drought_full_region_300m_v9.csv'))
#Add the group name for each time series
first$drought <- '2012-2015 Only'
second$drought <- 'Both Droughts'
#Add sample size for each time series
first$count <- as.numeric(8923)
second$count <- as.numeric(49222)
#Combine the time series data into on data frame
time.series <- rbind(first, second)
#Rename the system.time_start column
names(time.series)[names(time.series) == 'system.time_start'] <- 'time_start'
#Convert time_start to a Date object
time.series$time_start <- as.Date(time.series$time_start)
#Create a year column
time.series$year <- format(time.series$time_start, '%Y')
#Convert acres to hectares
time.series$tpa_sum <- time.series$tpa_sum * 2.41705 * 2.25 # convert acres to hectares and then convert 150 m pixels (2.25 hectares) into number of dead trees
# time.series$tpa <- time.series$tpa_sum / (time.series$tpa_count * 2.25)
time.series$tpa_mean <- time.series$tpa_mean * 2.41705
time.series$tpa_stdDev <- time.series$tpa_stdDev * 2.41705
# time.series$tpa_stdError <- time.series$tpa_stdDev / sqrt(time.series$tpa_count)
time.series$tpa_p100 <- time.series$tpa_p100 * 2.41705
time.series$tpa_p50 <- time.series$tpa_p50 * 2.41705
time.series$tpa_p75 <- time.series$tpa_p75 * 2.41705
time.series$tpa_p25 <- time.series$tpa_p25 * 2.41705
time.series$tpa_low_area <- (time.series$tpa_mid_sum / time.series$tpa_count) * 100
time.series$biomass_mean[time.series$biomass_mean == 0] <- NA
#Make the drought/Region a factor
time.series$drought <- factor(time.series$drought)
#Create an ADS proportion time series
p1 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = tpa_low_area, color = drought, linetype = drought), size = 0.5, na.rm = TRUE) +
theme_bw() + guides(color = guide_legend(title = 'Drought Sequence', nrow = 2, title.position = 'top'), linetype = "none") +
scale_linetype_manual(values=c("solid", "twodash")) +
geom_hline(yintercept = 0, linetype='dashed') +
scale_color_manual(values=c("#E66100", "#5D3A9B"), labels = c('Both \nDroughts', '2012-2015 \nOnly')) +
theme(axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10), axis.title.x = element_blank(), legend.position = c(0.2, 0.6), legend.background = element_rect(colour = NA, fill = NA),
legend.key = element_rect(fill = NA), axis.text.x = element_blank(), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
ylab('Die-off\n(% Area)')
#Create a dNDMI time series
p2 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = dNDMI_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=dNDMI_mean - (dNDMI_stdDev / sqrt(count) * 1.96), ymax=dNDMI_mean + (dNDMI_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() + geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10), axis.title.x=element_blank(), legend.position = 'none',
axis.text.x=element_blank(), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
ylab('dNDMI') + geom_text(data = data.frame(label = "95% CI", x = as.Date('2018-06-30'), y = -0.019, sequence = 'Both Droughts'), mapping = aes(x=x, y=y, label = label), size = 1)
#Create a biomass density time series.
p3 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = biomass_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=biomass_mean - (biomass_stdDev / sqrt(count) * 1.96), ymax=biomass_mean + (biomass_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Create a Pr-ET time series graph
p4 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = PET_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=PET_mean - (PET_stdDev / sqrt(count) * 1.96), ymax=PET_mean + (PET_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Combine the three time series graphs into one
(p1 / p2 / p3 / p4) + plot_annotation(tag_levels = 'a', theme = theme(legend.margin=margin(t = 0, unit='cm'))) + plot_layout(heights = c(0.95,0.95,0.95,1))
p3 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = biomass_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=biomass_mean - (biomass_stdDev / sqrt(count) * 1.96), ymax=biomass_mean + (biomass_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() + ylim(75, 200) +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Create a Pr-ET time series graph
p4 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = PET_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=PET_mean - (PET_stdDev / sqrt(count) * 1.96), ymax=PET_mean + (PET_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Combine the three time series graphs into one
(p1 / p2 / p3 / p4) + plot_annotation(tag_levels = 'a', theme = theme(legend.margin=margin(t = 0, unit='cm'))) + plot_layout(heights = c(0.95,0.95,0.95,1))
p3 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = biomass_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=biomass_mean - (biomass_stdDev / sqrt(count) * 1.96), ymax=biomass_mean + (biomass_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() + ylim(90, 190) +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10), axis.title.x = element_blank(), legend.position = c(0.2, 0.6), legend.background = element_rect(colour = NA, fill = NA),
legend.key = element_rect(fill = NA), axis.text.x = element_blank(), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
ylab(expression('Biomass\n(Mg ha'^-1*')'))
#Create a Pr-ET time series graph
p4 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = PET_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=PET_mean - (PET_stdDev / sqrt(count) * 1.96), ymax=PET_mean + (PET_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Combine the three time series graphs into one
(p1 / p2 / p3 / p4) + plot_annotation(tag_levels = 'a', theme = theme(legend.margin=margin(t = 0, unit='cm'))) + plot_layout(heights = c(0.95,0.95,0.95,1))
p3 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = biomass_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=biomass_mean - (biomass_stdDev / sqrt(count) * 1.96), ymax=biomass_mean + (biomass_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() + ylim(90, 190) +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10), axis.title.x = element_blank(), legend.position = 'none',
axis.text.x = element_blank(), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
ylab(expression('Biomass\n(Mg ha'^-1*')'))
#Create a Pr-ET time series graph
p4 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = PET_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=PET_mean - (PET_stdDev / sqrt(count) * 1.96), ymax=PET_mean + (PET_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Combine the three time series graphs into one
(p1 / p2 / p3 / p4) + plot_annotation(tag_levels = 'a', theme = theme(legend.margin=margin(t = 0, unit='cm'))) + plot_layout(heights = c(0.95,0.95,0.95,1))
p3 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = biomass_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=biomass_mean - (biomass_stdDev / sqrt(count) * 1.96), ymax=biomass_mean + (biomass_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() + ylim(100, 190) +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.y = element_text(size = 8), axis.title.y = element_text(size = 10), axis.title.x = element_blank(), legend.position = 'none',
axis.text.x = element_blank(), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
ylab(expression('Biomass\n(Mg ha'^-1*')'))
#Create a Pr-ET time series graph
p4 <- ggplot() +
geom_rect(data = data.frame(xmin = as.Date('1998-10-01'), xmax = as.Date('2002-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_rect(data = data.frame(xmin = as.Date('2011-10-01'), xmax = as.Date('2015-09-30'), ymin = -Inf, ymax = Inf),
fill = "red", alpha = 0.3, mapping = aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax)) +
geom_line(data = time.series, mapping = aes(x = time_start, y = PET_mean, color = drought, linetype = drought), size = 0.5) +
geom_errorbar(data=time.series, mapping=aes(x=time_start, ymin=PET_mean - (PET_stdDev / sqrt(count) * 1.96), ymax=PET_mean + (PET_stdDev / sqrt(count) * 1.96), color = drought, linetype = drought),
size = 0.4, width = 100, alpha = 0.6) +
theme_bw() +
geom_hline(yintercept = 0, linetype='dashed') +
scale_linetype_manual(values=c("solid", "twodash")) +
scale_color_manual(values=c("#E66100", "#5D3A9B")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), legend.position = 'none',
axis.title.y = element_text(size = 10), plot.margin = unit(c(0.5,0.5,0.5,0.5), "pt"), legend.title = element_text(size = 8), legend.text = element_text(size = 6)) +
xlab('Year') + ylab(expression('Pr-ET\n(mm yr'^-1*')'))
#Combine the three time series graphs into one
(p1 / p2 / p3 / p4) + plot_annotation(tag_levels = 'a', theme = theme(legend.margin=margin(t = 0, unit='cm'))) + plot_layout(heights = c(0.95,0.95,0.95,1))
#Save and export the figure as a .png file
ggsave(filename = 'Fig2_drought_time_series.png', height=14, width=11, units = 'cm', dpi=900)
