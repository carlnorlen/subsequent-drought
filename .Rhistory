(ADS_2017) < 5 ~ 0)) #No Mortality
#Do binning by SPI48 and Pr-ET over four years.
all.ca.spi48 <- all.ca %>%
dplyr::mutate(socal = as.integer(USFS_zone == 262), sierra = as.integer(USFS_zone == 261)) %>% #Make new columns that have 0,1 for Sierra and socal to calculate proportions later
dplyr::mutate(spi48_09_2002.bin = cut(spi48_09_2002, breaks = seq(-3.5, 2, by = 0.1)),
spi48_09_2015.bin = cut(spi48_09_2015, breaks = seq(-3.5, 2, by = 0.1)),
) %>%
dplyr::group_by(spi48_09_2002.bin, spi48_09_2015.bin) %>%
dplyr::mutate(dNDMI_1994.mean = mean(dNDMI_1994)) %>%
dplyr::mutate(dNDMI_2004.mean = mean(dNDMI_2004)) %>%
dplyr::mutate(dNDMI_2017.mean = mean(dNDMI_2017)) %>%
dplyr::mutate(PET_4yr_1992.mean = mean(PET_4yr_1992)) %>%
dplyr::mutate(PET_4yr_2002.mean = mean(PET_4yr_2002)) %>%
dplyr::mutate(PET_4yr_2015.mean = mean(PET_4yr_2015)) %>%
dplyr::mutate(biomass_1999.mean = mean(biomass_1999)) %>%
dplyr::mutate(biomass_2012.mean = mean(biomass_2012)) %>%
dplyr::mutate(tmax_4yr_2002.mean = mean(tmax_4yr_2002)) %>%
dplyr::mutate(tmax_4yr_2015.mean = mean(tmax_4yr_2015)) %>%
dplyr::mutate(dNDMI_2004.median = median(dNDMI_2004)) %>%
dplyr::mutate(dNDMI_2017.median = median(dNDMI_2017)) %>%
dplyr::mutate(ADS_2004.mean = mean(ADS_2004)) %>%
dplyr::mutate(ADS_2017.mean = mean(ADS_2017)) %>%
dplyr::mutate(count = n()) %>%
dplyr::mutate(socal_count = sum(socal), sierra_count = sum(sierra)) %>%
dplyr::mutate(socal_prop = (socal_count / count) * 100, sierra_prop = (sierra_count / count) * 100) %>% # Calculate Sierra and SoCal proportions.
dplyr::mutate(dominant_region = as.integer(socal_prop > sierra_prop)) %>%
dplyr::mutate(ADS_2004.count = sum(ADS_2004.cat), ADS_2017.count = sum(ADS_2017.cat)) %>%
dplyr::mutate(ADS_2004.total = count, ADS_2017.total = count) %>%
dplyr::mutate(ADS_2004.prop = (ADS_2004.count / ADS_2004.total) * 100, ADS_2017.prop = (ADS_2017.count / ADS_2017.total) * 100) %>%
mutate(dSPI48 = abs(spi48_09_2015 - spi48_09_2002)) %>%
ungroup()
#Calculate proportion of Both Droughts in Socal
both.socal <- all.ca.spi48 %>% filter(drought.sequence == 'Both Droughts') %>% dplyr::select(socal) %>% sum()
both.count <- all.ca.spi48 %>% filter(drought.sequence == 'Both Droughts') %>% dplyr::select(socal) %>% count()
both.socal / both.count
#Calculate proportion of 2012-2015 Only in Sierra Nevada
second.socal <- all.ca.spi48 %>% filter(drought.sequence == '2012-2015 Only') %>% dplyr::select(sierra) %>% sum()
second.count <- all.ca.spi48 %>% filter(drought.sequence == '2012-2015 Only') %>% dplyr::select(sierra) %>% count()
second.socal / second.count
#Add columns for labeling plots.
all.ca.spi48$both <- 'Response During 1st Period'#'1999-2002'
all.ca.spi48$second <- 'Response During 2nd Period'#'2012-2015'
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = FALSE) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "Region", limits = c(0, 100), midpoint = 50,  breaks = c(0, 50, 100), labels = c('Southern \nCalifornia', '50/50 \nMix', 'Sierra \nNevada'),
low = "black", mid = "cornsilk", high = "dark grey")
p13
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2()
p13
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient(name = "dSPI48", low = "blue", high = "red", na.value = 'transparent')
p13
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
p14
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "dSPI48", limits = c(0,1), midpoint = 0.5, low = "blue", high = "red", mid = 'green', na.value = 'transparent')
# p13
#Add annotations and move the legend into the corner of the figure.
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
p14
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "dSPI48", limits = c(0,1), midpoint = 0.5, low = "blue", high = "red", mid = 'green', na.value = 'grey')
# p13
#Add annotations and move the legend into the corner of the figure.
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
p14
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "dSPI48", limits = c(0,1.0), midpoint = 0.5, low = "green", high = "pink", mid = 'white', na.value = 'grey')
# p13
#Add annotations and move the legend into the corner of the figure.
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
p14
#Save the figure as a png
ggsave(filename = 'SFig19_spi48_dspi48_socal_SPI48_grid_scatter.png', device = 'png', height=6, width=7, units = 'cm', dpi=900)
spi48_2015.300m <- raster(file.path(socal_dir, 'Drought_second_300m_v6.tif'))
spi48_2002.300m <- raster(file.path(socal_dir, 'Drought_first_300m_v6.tif'))
spi48.300m.both <- spi48_2002.300m + spi48_2015.300m
spi48.300m.both.crop <- crop(spi48.300m.both, west.ext)
spi48.300m.m <- spi48.300m.both.crop == -9999
spi48.300m.both.mask <- mask(spi48.300m.both.crop, mask = spi48.300m.m, maskvalue = 1)
# # # File Directories
socal_dir <- "D:\\Large_Files\\Subsequent_Drought"
spi48_2015.300m <- raster(file.path(socal_dir, 'Drought_second_300m_v6.tif'))
spi48_2002.300m <- raster(file.path(socal_dir, 'Drought_first_300m_v6.tif'))
spi48.300m.both <- spi48_2002.300m + spi48_2015.300m
spi48.300m.both.crop <- crop(spi48.300m.both, west.ext)
spi48.300m.m <- spi48.300m.both.crop == -9999
spi48.300m.both.mask <- mask(spi48.300m.both.crop, mask = spi48.300m.m, maskvalue = 1)
p1 <- ggplot() +
ggR(img = spi48.300m.both.mask, layer = 1, maxpixels = 1e10, geom_raster = TRUE, ggLayer = TRUE, forceCat = TRUE) +
scale_fill_manual(values = c("1" = "#E1BE6A","2" = "#5D3A9B","3" = "#E66100", "0" = 'white'), breaks = c("1", "2", "3", "0"), name = expression(atop(NA,atop(textstyle('Severe Drought'),textstyle('(SPI48'<= -1.5*')')))),
labels = c("1st Drought \nOnly", "2nd Drought \nOnly", "Both \nDroughts", "Neither \nDrought"), na.value = NA) +
geom_sf(data = ca_20m, color='black', size = 0.2, fill=NA) +
geom_sf(data = usfs.sierra.union, color='black', size = 0.6,  fill='black', alpha = 0.2) +
geom_sf(data = usfs.socal.union, color='black', size = 0.6,  fill='black', alpha = 0.2) +
coord_sf() +
xlab('Longitude') + ylab('Latitude') +
annotation_scale(location = "bl", height = unit(0.1, "cm"), width_hint = 0.2) +
annotation_north_arrow(location = "br", which_north = "true",
height = unit(1, "cm"), width = unit(1, "cm"),
pad_x = unit(0.1, "cm"), pad_y = unit(0.1, "cm"),
style = north_arrow_minimal) + theme_bw() + guides(fill = guide_legend(title.position = "top")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
legend.key = element_rect(fill = NA), legend.text=element_text(size=8), legend.title = element_text(size=8),  plot.margin = unit(c(0,5,0,10), "pt"))
# p1
#Add annotations to map of SPI48 exposure
p2 <- p1 +
theme(
legend.justification = c(1, 0),
legend.position = c(0.89, 0.6),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "vertical") +
guides(fill = guide_legend(ncol = 1, nrow = 3,
title.position = "top", title.hjust = 0.5), override.aes = list(fill = 0.4))
p2
p2 <- p1 +
theme(
legend.justification = c(1, 0),
legend.position = c(0.89, 0.6),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "vertical") +
guides(fill = guide_legend(ncol = 1, nrow = 4,
title.position = "top", title.hjust = 0.5), override.aes = list(fill = 0.4))
p2
p1 <- ggplot() +
ggR(img = spi48.300m.both.mask, layer = 1, maxpixels = 1e10, geom_raster = TRUE, ggLayer = TRUE, forceCat = TRUE) +
scale_fill_manual(values = c("1" = "#E1BE6A","2" = "#5D3A9B","3" = "#E66100", "0" = 'white'), breaks = c("1", "2", "3", "0"), name = expression(atop(NA,atop(textstyle('Severe Drought'),textstyle('(SPI48'<= -1.5*')')))),
labels = c("1st Drought \nOnly", "2nd Drought \nOnly", "Both \nDroughts", "Neither \nDrought"), na.value = "transparent") +
geom_sf(data = ca_20m, color='black', size = 0.2, fill=NA) +
geom_sf(data = usfs.sierra.union, color='black', size = 0.6,  fill='black', alpha = 0.2) +
geom_sf(data = usfs.socal.union, color='black', size = 0.6,  fill='black', alpha = 0.2) +
coord_sf() +
xlab('Longitude') + ylab('Latitude') +
annotation_scale(location = "bl", height = unit(0.1, "cm"), width_hint = 0.2) +
annotation_north_arrow(location = "br", which_north = "true",
height = unit(1, "cm"), width = unit(1, "cm"),
pad_x = unit(0.1, "cm"), pad_y = unit(0.1, "cm"),
style = north_arrow_minimal) + theme_bw() + guides(fill = guide_legend(title.position = "top")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
legend.key = element_rect(fill = NA), legend.text=element_text(size=8), legend.title = element_text(size=8),  plot.margin = unit(c(0,5,0,10), "pt"))
# p1
#Add annotations to map of SPI48 exposure
p2 <- p1 +
theme(
legend.justification = c(1, 0),
legend.position = c(0.89, 0.6),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "vertical") +
guides(fill = guide_legend(ncol = 1, nrow = 4,
title.position = "top", title.hjust = 0.5), override.aes = list(fill = 0.4))
p2
plot(spi48_2015.300m)
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "dSPI48", limits = c(0,1.2), midpoint = 0.5, low = "green", high = "pink", mid = 'white', na.value = 'grey')
# p13
#Add annotations and move the legend into the corner of the figure.
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
# p14
#Save the figure as a png
# p14
#Save the figure as a png
ggsave(filename = 'SFig19_spi48_dspi48_socal_SPI48_grid_scatter.png', device = 'png', height=6, width=7, units = 'cm', dpi=900)
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "dSPI48", limits = c(0,1.1), midpoint = 0.5, low = "green", high = "pink", mid = 'white', na.value = 'grey')
# p13
#Add annotations and move the legend into the corner of the figure.
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
# p14
#Save the figure as a png
ggsave(filename = 'SFig19_spi48_dspi48_socal_SPI48_grid_scatter.png', device = 'png', height=6, width=7, units = 'cm', dpi=900)
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "dSPI48", limits = c(0,1.15), midpoint = 0.5, low = "green", high = "pink", mid = 'white', na.value = 'grey')
# p13
#Add annotations and move the legend into the corner of the figure.
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
# p14
#Save the figure as a png
ggsave(filename = 'SFig19_spi48_dspi48_socal_SPI48_grid_scatter.png', device = 'png', height=6, width=7, units = 'cm', dpi=900)
p13 <-ggplot(subset(all.ca.spi48, count >= 20), mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = dSPI48, group = dSPI48)) +
geom_bin2d(mapping = aes(group = dSPI48), binwidth = c(0.1, 0.1)) + theme_bw() +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 2012-2015') +  xlab('SPI48 1999-2002') +
# geom_vline(xintercept = 0, size = 0.25) +
# geom_hline(yintercept = 0, size = 0.25) +
geom_vline(xintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 0.5, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(title.position = "top", title.hjust = 0.5, title.vjust = 0.5, barwidth = 4, barheight = 1, ticks.colour = "black"), alpha = "none") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) + #Presentation text sizes.
scale_fill_gradient2(name = "dSPI48", limits = c(0,1.2), breaks = c(0.25, 0.5, 0.75, 1.0), midpoint = 0.5, low = "green", high = "pink", mid = 'white', na.value = 'grey')
# p13
#Add annotations and move the legend into the corner of the figure.
p14 <- p13 +
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.88, 0.6),
legend.text = element_text(size = 4),
legend.title = element_text(size = 6),
legend.direction = "horizontal")
# p14
#Save the figure as a png
ggsave(filename = 'SFig19_spi48_dspi48_socal_SPI48_grid_scatter.png', device = 'png', height=6, width=7, units = 'cm', dpi=900)
spi48_2015.300m <- raster(file.path(socal_dir, 'Drought_second_300m_v7.tif'))
plot(spi48_2015.300m)
#Add SPI48 layers for different years and a combined layer based on SPI48 exposure
spi48_2015.300m <- raster(file.path(socal_dir, 'Drought_second_300m_v7.tif'))
#Add SPI48 layers for different years and a combined layer based on SPI48 exposure
spi48_2015.300m <- raster(file.path(socal_dir, 'Drought_second_300m_v7.tif'))
# # # File Directories
socal_dir <- "D:\\Subsequent_Drought"
spi48_2015.300m <- raster(file.path(socal_dir, 'Drought_second_300m_v7.tif'))
plot(spi48_2015.300m)
spi48_2002.300m <- raster(file.path(socal_dir, 'Drought_first_300m_v7.tif'))
spi48.300m.both <- spi48_2002.300m + spi48_2015.300m
spi48.300m.both.crop <- crop(spi48.300m.both, west.ext)
spi48.300m.m <- spi48.300m.both.crop == -9999
spi48.300m.both.mask <- mask(spi48.300m.both.crop, mask = spi48.300m.m, maskvalue = 1)
p1 <- ggplot() +
ggR(img = spi48.300m.both.mask, layer = 1, maxpixels = 1e10, geom_raster = TRUE, ggLayer = TRUE, forceCat = TRUE) +
scale_fill_manual(values = c("1" = "#E1BE6A","2" = "#5D3A9B","3" = "#E66100", "0" = 'white'), breaks = c("1", "2", "3", "0"), name = expression(atop(NA,atop(textstyle('Severe Drought'),textstyle('(SPI48'<= -1.5*')')))),
labels = c("1st Drought \nOnly", "2nd Drought \nOnly", "Both \nDroughts", "Neither \nDrought"), na.value = NA) +
geom_sf(data = ca_20m, color='black', size = 0.2, fill=NA) +
geom_sf(data = usfs.sierra.union, color='black', size = 0.6,  fill='black', alpha = 0.2) +
geom_sf(data = usfs.socal.union, color='black', size = 0.6,  fill='black', alpha = 0.2) +
coord_sf() +
xlab('Longitude') + ylab('Latitude') +
annotation_scale(location = "bl", height = unit(0.1, "cm"), width_hint = 0.2) +
annotation_north_arrow(location = "br", which_north = "true",
height = unit(1, "cm"), width = unit(1, "cm"),
pad_x = unit(0.1, "cm"), pad_y = unit(0.1, "cm"),
style = north_arrow_minimal) + theme_bw() + guides(fill = guide_legend(title.position = "top")) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
legend.key = element_rect(fill = NA), legend.text=element_text(size=8), legend.title = element_text(size=8),  plot.margin = unit(c(0,5,0,10), "pt"))
# p1
#Add annotations to map of SPI48 exposure
p2 <- p1 +
theme(
legend.justification = c(1, 0),
legend.position = c(0.89, 0.6),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "vertical") +
guides(fill = guide_legend(ncol = 1, nrow = 4,
title.position = "top", title.hjust = 0.5), override.aes = list(fill = 0.4))
p2
p3 <- ggplot(all.ca.spi48, mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = count, group = count)) +
geom_bin2d(mapping = aes(group = count, alpha = ..count..), binwidth = c(0.1, 0.1)) + theme_bw() +
theme(legend.position="bottom", legend.text = element_text(size=6)) +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 During 2nd Period (2012-2015)') +  xlab('SPI48 During 1st Period (1999-2002)') +
# geom_vline(xintercept = 0, size = 0.5) +
# geom_hline(yintercept = 0, size = 0.5) +
geom_vline(xintercept = -1.5, size = 1, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 1, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(barwidth = 5, barheight = 1, title.position = "top", title.hjust = 0.5, title.vjust = 0.5, ticks.colour = "black"), alpha = FALSE) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), legend.background = element_rect(colour = NA, fill = NA),
legend.justification = c(1, 0), legend.position = c(0.99, 0.6), legend.text = element_text(size = 6),
legend.title = element_text(size = 8), legend.direction = "horizontal", strip.text = element_text(size = 12),
plot.margin = unit(c(10,0,10,10), "pt")) +
scale_fill_gradient2(name = "Total Area\n(# Grid Cells)", limits = c(0,2950), midpoint = 1475, low = "cornflowerblue",
mid = "yellow", high = "red", na.value = 'transparent') +
coord_cartesian(clip = 'off') + #Turn off clipping
scale_alpha(range = c(1, 1), limits = c(20, 2950), na.value = 0.4)
#Add annotations and move the legend into the corner of the figure.
p4 <- p3 + annotate("text", x = -0.5, y = -0.5, label = "Neither \nDrought") + annotate("text", x = -2.4, y = -0.5, label = "1st Drought \nOnly") +
annotate("text", x = -2.4, y = -3, label = "Both \nDroughts") + annotate("text", x = 1, y = -2, label = "2nd Drought \nOnly") +
annotation_custom(grob = textGrob(label = "Drier", hjust = 0, gp = gpar(fontface = 'bold', fontsize = 8)),
ymin = -3.5, ymax = -3.5,      # Vertical position of the textGrob
xmin = -3.1, xmax = -3.1) +     # Horizontal position
annotation_custom(grob = textGrob(label = "Wetter", hjust = 0, gp = gpar(fontface = 'bold', fontsize = 8)),
ymin = -3.5, ymax = -3.5,      # Vertical position of the textGrob
xmin = 1.75, xmax = 1.75 ) +     # Horizontal position
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.92, 0.7),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "horizontal")
#Combine the two figures into one plot, add letters to label sub-plots
f1 <- ggarrange(p2, p4, ncol = 2, nrow = 1, common.legend = FALSE, align = 'h', heights = c(1,1), widths = c(1, 1.5), labels = c('a)', 'b)')) #,  plot.margin = unit(c(0,3,0,0), "pt")
# f1
#Save the figure as a .png file
ggsave(filename = 'Fig1_both_droughts_SPI48_300m_map.png', height=10, width= 20, units = 'cm', dpi=900)
p4 <- p3 + annotate("text", x = -0.5, y = -0.5, label = "Neither \nDrought") + annotate("text", x = -2.4, y = -0.5, label = "1st Drought \nOnly") +
annotate("text", x = -2.4, y = -3, label = "Both \nDroughts") + annotate("text", x = 1, y = -2, label = "2nd Drought \nOnly") +
annotation_custom(grob = textGrob(label = "Drier", hjust = 0, gp = gpar(fontface = 'bold', fontsize = 8)),
ymin = -3.5, ymax = -3.5,      # Vertical position of the textGrob
xmin = -3.1, xmax = -3.1) +     # Horizontal position
annotation_custom(grob = textGrob(label = "Wetter", hjust = 0, gp = gpar(fontface = 'bold', fontsize = 8)),
ymin = -3.5, ymax = -3.5,      # Vertical position of the textGrob
xmin = 1.75, xmax = 1.75 ) +     # Horizontal position
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.92, 0.67),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "horizontal")
#Combine the two figures into one plot, add letters to label sub-plots
f1 <- ggarrange(p2, p4, ncol = 2, nrow = 1, common.legend = FALSE, align = 'h', heights = c(1,1), widths = c(1, 1.5), labels = c('a)', 'b)')) #,  plot.margin = unit(c(0,3,0,0), "pt")
# f1
#Save the figure as a .png file
ggsave(filename = 'Fig1_both_droughts_SPI48_300m_map.png', height=10, width= 20, units = 'cm', dpi=900)
p2 <- p1 +
theme(
legend.justification = c(1, 0),
legend.position = c(0.89, 0.55),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "vertical") +
guides(fill = guide_legend(ncol = 1, nrow = 4,
title.position = "top", title.hjust = 0.5), override.aes = list(fill = 0.4))
# p2
#Create a figure of the sample size comparing SPI48 2002 versus SPI48 2015
p3 <- ggplot(all.ca.spi48, mapping = aes(x = spi48_09_2002, y = spi48_09_2015, fill = count, group = count)) +
geom_bin2d(mapping = aes(group = count, alpha = ..count..), binwidth = c(0.1, 0.1)) + theme_bw() +
theme(legend.position="bottom", legend.text = element_text(size=6)) +
ylim(-3.5, 0) + xlim(-3, 2) +
ylab('SPI48 During 2nd Period (2012-2015)') +  xlab('SPI48 During 1st Period (1999-2002)') +
# geom_vline(xintercept = 0, size = 0.5) +
# geom_hline(yintercept = 0, size = 0.5) +
geom_vline(xintercept = -1.5, size = 1, color = 'black', linetype='dashed') +
geom_hline(yintercept = -1.5, size = 1, color = 'black', linetype='dashed') +
guides(fill = guide_colorbar(barwidth = 5, barheight = 1, title.position = "top", title.hjust = 0.5, title.vjust = 0.5, ticks.colour = "black"), alpha = FALSE) +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10),
axis.title.y = element_text(size = 10), legend.background = element_rect(colour = NA, fill = NA),
legend.justification = c(1, 0), legend.position = c(0.99, 0.6), legend.text = element_text(size = 6),
legend.title = element_text(size = 8), legend.direction = "horizontal", strip.text = element_text(size = 12),
plot.margin = unit(c(10,0,10,10), "pt")) +
scale_fill_gradient2(name = "Total Area\n(# Grid Cells)", limits = c(0,2950), midpoint = 1475, low = "cornflowerblue",
mid = "yellow", high = "red", na.value = 'transparent') +
coord_cartesian(clip = 'off') + #Turn off clipping
scale_alpha(range = c(1, 1), limits = c(20, 2950), na.value = 0.4)
#Add annotations and move the legend into the corner of the figure.
p4 <- p3 + annotate("text", x = -0.5, y = -0.5, label = "Neither \nDrought") + annotate("text", x = -2.4, y = -0.5, label = "1st Drought \nOnly") +
annotate("text", x = -2.4, y = -3, label = "Both \nDroughts") + annotate("text", x = 1, y = -2, label = "2nd Drought \nOnly") +
annotation_custom(grob = textGrob(label = "Drier", hjust = 0, gp = gpar(fontface = 'bold', fontsize = 8)),
ymin = -3.5, ymax = -3.5,      # Vertical position of the textGrob
xmin = -3.1, xmax = -3.1) +     # Horizontal position
annotation_custom(grob = textGrob(label = "Wetter", hjust = 0, gp = gpar(fontface = 'bold', fontsize = 8)),
ymin = -3.5, ymax = -3.5,      # Vertical position of the textGrob
xmin = 1.75, xmax = 1.75 ) +     # Horizontal position
theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.92, 0.7),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "horizontal")
#Combine the two figures into one plot, add letters to label sub-plots
f1 <- ggarrange(p2, p4, ncol = 2, nrow = 1, common.legend = FALSE, align = 'h', heights = c(1,1), widths = c(1, 1.5), labels = c('a)', 'b)')) #,  plot.margin = unit(c(0,3,0,0), "pt")
# f1
#Save the figure as a .png file
ggsave(filename = 'Fig1_both_droughts_SPI48_300m_map.png', height=10, width= 20, units = 'cm', dpi=900)
p2 <- p1 +
theme(
legend.justification = c(1, 0),
legend.position = c(0.89, 0.52),
legend.text = element_text(size = 6),
legend.title = element_text(size = 8),
legend.direction = "vertical") +
guides(fill = guide_legend(ncol = 1, nrow = 4,
title.position = "top", title.hjust = 0.5), override.aes = list(fill = 0.4))
f1 <- ggarrange(p2, p4, ncol = 2, nrow = 1, common.legend = FALSE, align = 'h', heights = c(1,1), widths = c(1, 1.5), labels = c('a)', 'b)')) #,  plot.margin = unit(c(0,3,0,0), "pt")
# f1
#Save the figure as a .png file
ggsave(filename = 'Fig1_both_droughts_SPI48_300m_map.png', height=10, width= 20, units = 'cm', dpi=900)
