all.ca.2ndDrought$drought <- '2012-2015'
#Rename the columns
colnames(all.ca.2ndDrought) <- c('pixel.id', 'NDMI', 'dNDMI', 'dET', 'dBiomass', 'PET_4yr', 'ppt_4yr', 'tmax_4yr', 'ET_4yr', 'ET', 'biomass', 'ADS', 'spi48', 'elevation', 'latitude', 'longitude', 'USFS', 'sequence', 'drought')
#Combine all the data in one data frame
all.ca.combined <- rbind(all.ca.1stDrought, all.ca.2ndDrought)
#Translate the region code to text
all.ca.combined$region[all.ca.combined$USFS == 261] <- "Sierra Nevada"
all.ca.combined$region[all.ca.combined$USFS == 262] <- "Southern California"
#Convert the ADS data to categorical mortality or no mortality
all.ca.combined <- all.ca.combined %>% mutate(ADS.cat = case_when(
(ADS) >= 5 ~ 1, #mortality
(ADS) < 5 ~ 0)) #no mortality
#Make drought sequence into dummy categorical variables for statistical analysis
all.ca.sample <- all.ca.combined %>% mutate(sequence.f = case_when(
sequence == 'Both Droughts' ~ 0,
sequence == '2nd Drought Only' ~ 1))
#Make years into dummy variables for statistical analysis
all.ca.sample <- all.ca.sample %>% mutate(drought.f = case_when(
drought == '1999-2002' ~ 0,
drought == '2012-2015' ~ 1))
#Select the drought sequence samples and data columns for analysis
dataset <- all.ca.sample %>% dplyr::filter(sequence == 'Both Droughts' | sequence == '2012-2015 Only') %>%
dplyr::select('PET_4yr', 'NDMI', 'dNDMI', 'drought.f', 'sequence.f', 'biomass', 'pixel.id', 'tmax_4yr', 'ADS.cat')
#Convert the dummy variables to a numeric format
dataset$sequence.f <- as.numeric(dataset$sequence.f)
dataset$drought.f <- as.numeric(dataset$drought.f)
#Calculate sample size for 1999-2002 and proportion impacted by drought
all.ca.combined %>% dplyr::filter(drought == '1999-2002' & spi48 <= -1.5) %>% count()
all.ca.combined %>% dplyr::filter(drought == '1999-2002' & spi48 <= -1.5) %>% count() / all.ca.combined %>% dplyr::filter(drought == '1999-2002') %>% count()
#Calculate sample sizes for 2012-2015 and proportion impacted by drought
all.ca.combined %>% dplyr::filter(drought == '2012-2015' & spi48 <= -1.5) %>% count()
all.ca.combined %>% dplyr::filter(drought == '2012-2015' & spi48 <= -1.5) %>% count() / all.ca.combined %>% dplyr::filter(drought == '2012-2015') %>% count()
#Convert dummy variable to factors
all.ca.sample$sequence.f <- all.ca.sample$sequence.f
all.ca.sample$drought.f <- all.ca.sample$drought.f
#Convert dummy variables to factors
dataset$sequence.f <- as.factor(dataset$sequence.f)
dataset$drought.f <- as.factor(dataset$drought.f)
#Create a task to undersample the drought sequence data by a factor of 0.2 for 2012-2015 Only
task = makeClassifTask(data = dataset, target = "sequence.f")
task.under <- undersample(task, rate = 0.2)
#The undersampled dataset
dataset.under <- getTaskData(task.under)
#Scale data sets to help with relative importance analysis.
dataset.under$dNDMI.scale <- scale(dataset.under$dNDMI)
dataset.under$PET_4yr.scale <- scale(dataset.under$PET_4yr)
dataset.under$biomass.scale <- scale(dataset.under$biomass)
dataset.under$tmax_4yr.scale <- scale(dataset.under$tmax_4yr)
dataset.under$sequence.scale <- scale(as.numeric(dataset.under$sequence.f))
dataset.under$drought.scale <- scale(as.numeric(dataset.under$drought.f))
#The full multiple regression linear model
dndmi.under.lm = lm(data = dataset.under,
formula = dNDMI ~ drought.f * sequence.f + PET_4yr + tmax_4yr + biomass)
#Get the model results as a datafram
df.dndmi.lm <- dndmi.under.lm %>% tidy() %>% as.data.frame()
#Label the columns of the data frame
df.dndmi.lm$variable <- c('Intercept', 'Time Period', 'Drought Sequence', 'four-year Pr-ET', 'four-year Temperature', 'Biomass', 'Time Period:Drought Sequence')
#Calculate the relative importance of model variables with a relative weight analysis.
dndmi.relimp <- calc.relimp(dndmi.under.lm, rela = TRUE, type = "lmg")
#Add the results of the relative weigth analysis to the data frame
df.dndmi.lm$relimp <- c(0, 0.03706293, 0.01952194, 0.36576597, 0.09262433, 0.02743045, 0.45759438)
#Covert the relative weight analysis outputs as percentages
df.dndmi.lm$relimp.pct <- df.dndmi.lm$relimp * 100
#Create a table of the relative weight analysis results
df.dndmi.tbl <- df.dndmi.lm %>% dplyr::select(variable, estimate, std.error, statistic, p.value, relimp.pct)
#Update the relative weight analysis column names
colnames(df.dndmi.tbl) <- c('Variable', 'Coefficient', 'Standard Error', 'T-Statistic', 'p-value', 'Relative Importance (%)')
#Create the data table with a title
tba <- kbl(df.dndmi.tbl, caption = "Table S4: Die-off (dNDMI) Multiple Linear Regression", digits = 3) %>% kable_classic_2(font_size = 14, full_width = F)
#Export the data table as a .PNG file
as_image(x = tba, width = 6, file = "STable4_multiple_regression_results.png", zoom = 5.0)
#Convert the dummy data back to a numeric format
dataset.under$sequence.f <- as.numeric(dataset.under$sequence.f)
dataset.under$drought.f <- as.numeric(dataset.under$drought.f)
#Filter the data into subsets for modeling
all.ca.both.1999 <- all.ca.sample %>% filter(sequence == 'Both Droughts' & drought == '1999-2002' & !is.na(sequence))
all.ca.both.2012 <- all.ca.sample %>% filter(sequence == 'Both Droughts' & drought == '2012-2015' & !is.na(sequence))
all.ca.second.1999 <- all.ca.sample %>% filter(sequence == '2nd Drought Only' & drought == '1999-2002' & !is.na(sequence))
all.ca.second.2012 <- all.ca.sample %>% filter(sequence == '2nd Drought Only' & drought == '2012-2015' & !is.na(sequence))
# #Linear Models for dNDMI ~ Pr-ET
#Models for Both Droughts
all.ca.both.1999.lm <- lm(data = all.ca.both.1999, dNDMI ~ PET_4yr) # 1999-2002 Model
all.ca.both.2012.lm <- lm(data = all.ca.both.2012, dNDMI ~ PET_4yr) # 2012-2015 Model
#Trying out a log transformation for the Pr-ET data
all.ca.combined.log.lm <- lm(data = all.ca.combined, dNDMI ~ log(PET_4yr +(min(PET_4yr)*-1 + 0.001)))
summary(all.ca.combined.log.lm)
all.ca.combined.lm <- lm(data = all.ca.combined, dNDMI ~ PET_4yr)
summary(all.ca.combined.lm)
#Models for 2012-2015 Only
all.ca.second.1999.lm <- lm(data = all.ca.second.1999, dNDMI ~ PET_4yr) # 1999-2002 Model
all.ca.second.1999.log.lm <- lm(data = all.ca.second.1999, dNDMI ~ I(1/(PET_4yr +(min(PET_4yr)*-1 + 0.001))))
summary(all.ca.second.1999.log.lm)
all.ca.second.2012.lm <- lm(data = all.ca.second.2012, dNDMI ~ PET_4yr) # 2012-2015 Model
summary(all.ca.second.2012.lm)
all.ca.second.2012.log.lm <- lm(data = all.ca.second.2012, dNDMI ~ PET_4yr)
summary(all.ca.second.2012.log.lm)
#Calculate the sgemented model
all.ca.both.1999.seg <- segmented(all.ca.both.1999.lm)
all.ca.second.2012.seg <- segmented(all.ca.second.2012.lm)
#Add predicted dNDMI values
all.ca.both.1999$dNDMI_predict = predict(all.ca.both.1999.seg)
all.ca.both.2012$dNDMI_predict = predict(all.ca.both.2012.lm )
all.ca.second.1999$dNDMI_predict = predict(all.ca.second.1999.lm)
all.ca.second.2012$dNDMI_predict = predict(all.ca.second.2012.seg)
#Recombine the data frames with the model fitted dNDMI as a column
all.ca.models <- rbind(all.ca.both.1999, all.ca.both.2012, all.ca.second.1999, all.ca.second.2012)
#R-Squared values for the four models
r2.a  <- format(summary(all.ca.both.1999.lm)$r.squared, digits = 3) #I could switch this back to segmented
r2.b <- format(summary(all.ca.both.2012.lm)$r.squared, digits = 2)
r2.c <- format(summary(all.ca.second.1999.lm)$r.squared, digits = 1)
r2.d <- format(summary(all.ca.second.2012.lm)$r.squared, digits = 3) #I could switch this back to segmented
#Create a data.frame of R.squared values
r2.text <- data.frame(
label = c(as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 =r2.a)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = r2.b)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = r2.c)))),
as.character(as.expression(substitute(italic(R)^2~"="~r2, list(r2 = r2.d))))
),
sequence = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002', '2012-2015'),
x = c(2500, 2500, 2500, 2500),
y = c(-0.25, -0.25, -0.25, -0.25)
)
letter.text <- data.frame(label = c("a)", "b)", "c)", "d)"),
sequence   = c('Both Droughts', 'Both Droughts', '2nd Drought Only', '2nd Drought Only'),
drought = c('1999-2002', '2012-2015', '1999-2002',  '2012-2015'),
y     = c(-0.3, -0.3, -0.3, -0.3),
x     = c(-2400, -2400, -2400, -2400)
)
#Plot dNDMI versus Pr-ET by drought sequence and time period.
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(5,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4)
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(5,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(5,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4, color = 'cornflowerblue') +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = count, alpha = ..count..)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(5,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4, color = 'cornflowerblue') +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = count, alpha = ..count..)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() + guides(alpha = FALSE) +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,370), breaks = c(0,5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
#Save the figure as a .png file
ggsave(filename = 'Fig5_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() + guides(alpha = FALSE) +
ylab(label = "Die-off During Period (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
#Save the figure as a .png file
ggsave(filename = 'Fig5_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() + guides(alpha = FALSE) +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 10), axis.text.y = element_text(size = 10), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
#Save the figure as a .png file
ggsave(filename = 'Fig5_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
p3 <- ggscatter(all.ca.models, x = "PET_4yr", y = "dNDMI", point = FALSE) +
geom_bin2d(binwidth = c(100, 0.0075), mapping = aes(group = ..count.., alpha = ..count..)) +
# geom_line(data = all.ca.models, mapping = aes(x=PET_4yr, y=dNDMI_predict), size=2, color = 'black') +
# geom_smooth(method = 'lm', color = 'black', size = 2) +
geom_smooth(method = 'lm', formula = y ~ x, color = 'black', size = 2, se = FALSE, na.rm = TRUE) +
# stat_cor(aes(label = paste(..rr.label..)), size = 3.5, digits = 2, label.x.npc = 0.75, label.y.npc = 0.9) +
theme_bw() + guides(alpha = FALSE) +
ylab(label = "Die-off Severity (dNDMI)") +  xlab(label = expression('Cummulative Water Deficit (Pr-ET; mm 4 yr'^-1*')')) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0) +
geom_text(data = r2.text, mapping = aes(x = x, y = y, label = label), size = 3.5, parse = TRUE) +
geom_text(data = letter.text, mapping = aes(x = x, y = y, label = label), size = 5, fontface = "bold") +
labs(fill = "Grid Cells") +
theme(axis.text.x = element_text(size = 8), axis.text.y = element_text(size = 8), axis.title.x = element_text(size = 10), axis.title.y = element_text(size = 10),
plot.title = element_text(size = 10, hjust = 0.5), strip.text.x = element_text(size = 10, face = 'bold'), strip.text.y = element_text(size = 10, face = 'bold')) + #Presentation text sizes.
scale_fill_gradient2(limits = c(0,370), breaks = c(5,100,200,300), midpoint = 185, low = "cornflowerblue", mid = "yellow", high = "red", na.value = 'transparent') +
scale_alpha(range = c(1, 1), limits = c(5, 370), na.value = 0.4) +
ylim(0.1, -0.3) + xlim(-2500, 3500) +
facet_grid(factor(sequence, levels = c('Both Droughts', '2nd Drought Only')) ~ drought,
labeller = as_labeller(c('1999-2002'='Response During 1st Period', '2012-2015'='Response During 2nd Period',
'Both Droughts' = 'Exposed to Both Droughts', '2nd Drought Only' = 'Exposed to 2nd Drought Only')))
#Add a shared legend in a customized position on the figure
p4 <- p3 + theme(
legend.background = element_rect(colour = NA, fill = NA), # This removes the white square behind the legend
legend.justification = c(1, 0),
legend.position = c(0.68, 0.8),
legend.text = element_text(size = 10),
legend.title = element_text(size = 10),
legend.direction = "vertical") +
guides(fill = guide_colorbar(barwidth = 1, barheight = 3,
title.position = "top",
title.hjust = 0.5,
ticks.colour = "black"))
p4
#Save the figure as a .png file
ggsave(filename = 'Fig5_regression_faceted_plot.png', device = 'png', height=16, width=16, units = 'cm', dpi=900)
